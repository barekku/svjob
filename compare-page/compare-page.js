"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Polymer({is:"compare-page",properties:{appService:{type:Element,value:function(){return document.querySelector("#appService")}},aggparams:Array,oarray:{type:Array,notify:!0},objects:{type:Object,value:function(){var t=0,e={};return{add:function(o){console.log(o);var r=o._id.$oid;e[r]=Object.assign({},o,!0),t++},del:function(o){console.log(o);var r=o.$oid;console.log(e,"O!"),delete e[r],console.log(e,"O!"),t--},list:function(){console.log(e,t)},get:function(){var t=[];for(var o in e)t.push(e[o]);return t}}}},moveItem:Element,overItem:Element},attached:function(){document.addEventListener("scroll",this.containerScroll)},_arrChanged:function(){console.log(this.$.titleCol.querySelectorAll(".columnTitle"),"observer")},selObj:function(t,e){console.log(e,"data");var o={method:"rc.find",params:{cmdName_value:"objects",filter:{_id:e.data._id}}};this.appService.sendAjax(o,{owner:this,func:"getObject"},"Loaded")},unselObj:function(t,e){console.log("unsel"),this.objects.del(e.data._id),this.getOArray()},_closeSearch:function(){var t=document.querySelector("compare-page::shadow .columns");if(t.clientWidth<t.scrollWidth){var e=document.querySelector("compare-page::shadow #colcontscroll");e.querySelector("div").style.width=t.scrollWidth+"px";var o=t.querySelector(".ipTitle");console.log(t,"cl");var r=e.offsetHeight-e.clientHeight;e.style.top=o.clientHeight-r+"px",e.style.display="block"}},objRemove:function(t){var e=t.target.parentNode.parentNode,o=e.dataArg,r=this.oarray;r.splice(o,1),console.log(r),this.oarray=[],this.oarray=r},getObject:function(t){console.log(t,"find"),console.log(t.result.cursor.firstBatch[0]),this.objects.add(t.result.cursor.firstBatch[0]),this.getOArray()},getOArray:function(){this.oarray=this.objects.get(),this.getAggParams(),this.$.colcontscrolld.style.width=202*this.oarray.length+"px"},getAggParams:function(){var t=this.oarray,e=[];if(t.length>0){for(var o=t[0].object,r=t.length;r-- >1;)for(var a in o)void 0===t[r].object[a]&&delete o[a];for(var n in o)e.push(n)}this.aggparams=e},getParam:function(t,e){var o=""!=t[e]?t[e]:"не задано";if(Array.isArray(o)&&(o="Array"),"object"==("undefined"==typeof o?"undefined":_typeof(o))&&o.hasOwnProperty("$date")){var r=new Date(o.$date);o=r.toISOString().substring(0,10)}return o},onScroll:function(t){this.$.scrcols.scrollLeft=this.$.colcontscroll.scrollLeft,t.preventDefault()},containerScroll:function(t){var e=document.querySelector("compare-page::shadow .columns"),o=e.getBoundingClientRect().top,r=document.querySelectorAll("compare-page::shadow .column");if(o<=50){r.forEach(function(t){t.querySelector(".ipTitle").style.marginTop=50-o+"px",t.querySelector(".propNames").style.marginTop=o-50+"px"});var a=e.querySelector("#colcontscroll"),n=r[0].querySelector(".ipTitle"),l=a.offsetHeight-a.clientHeight;a.style.top=n.clientHeight+50-o-l+"px"}if(o>50){r.forEach(function(t){t.querySelector(".ipTitle").style.marginTop=0,t.querySelector(".propNames").style.marginTop=0});var c=e.querySelector("#colcontscroll"),i=getComputedStyle(r[0].querySelector(".ipTitle")).height,s=c.offsetHeight-c.clientHeight;c.style.top=parseInt(i)-s+"px"}},test:function(t){console.dir(t)},dragStart:function(t){this.moveItem=t.target,t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/html",t.target)},dragEnter:function(t){t.target.classList.contains("column")&&(console.log("enter"),t.target.style.opacity=.4,t.preventDefault())},dragExit:function(t){t.target.classList.contains("column")&&(console.log("exit"),t.target.style.opacity=1),t.preventDefault(),t.stopPropagation()},dragDown:function(t){this.moveItem.style.opacity=1,console.log("down")},dragStop:function(t){console.log("drop",t.target.parentNode.parentNode.dataArg);for(var e=t.target;!e.classList.contains("column");)e=e.parentNode;var o=e.dataArg,r=this.moveItem.dataArg,a=this.oarray[r];console.log(o,r);var n=this.oarray;n.splice(this.moveItem.dataArg,1),n.splice(o,0,a),this.oarray=[],this.oarray=n},allowDrop:function(t){t.preventDefault()}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhZ2VzL2NvbXBhcmUtcGFnZS9jb21wYXJlLXBhZ2UuanMiXSwibmFtZXMiOlsiUG9seW1lciIsImlzIiwidHlwZSIsIkVsZW1lbnQiLCJwcm9wZXJ0aWVzIiwiYXBwU2VydmljZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFnZ3BhcmFtcyIsIm9hcnJheSIsIkFycmF5Iiwibm90aWZ5IiwiT2JqZWN0Iiwib2JqZWN0cyIsInZhbHVlIiwiYWRkIiwibyIsImNvbnNvbGUiLCJsb2ciLCJpZCIsIl9pZCIsImFzc2lnbiIsIl9sZW5ndGgiLCJkZWwiLCJfbyIsImFyciIsImdldCIsImkiLCJwdXNoIiwibW92ZUl0ZW0iLCJvdmVySXRlbSIsImF0dGFjaGVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInRoaXMiLCJjb250YWluZXJTY3JvbGwiLCJfYXJyQ2hhbmdlZCIsIiQiLCJ0aXRsZUNvbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzZWxPYmoiLCJlIiwiZCIsIm1ldGhvZCIsInBhcmFtcyIsImRhdGEiLCJzZW5kQWpheCIsIm93bmVyIiwiZnVuYyIsInVuc2VsT2JqIiwiX2Nsb3NlU2VhcmNoIiwiZ2V0T0FycmF5IiwiY2wiLCJzY3JvbGxXaWR0aCIsImNjIiwic3QiLCJjbGllbnRIZWlnaHQiLCJzaCIsInN0eWxlIiwib2Zmc2V0SGVpZ2h0Iiwib2JqUmVtb3ZlIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsImRhdGFBcmciLCJhIiwic3BsaWNlIiwiZ2V0T2JqZWN0IiwicmVzdWx0IiwiY3Vyc29yIiwiZmlyc3RCYXRjaCIsImdldEFnZ1BhcmFtcyIsIndpZHRoIiwibGVuZ3RoIiwiY29sY29udHNjcm9sbGQiLCJwcm0iLCJvYmplY3QiLCJwYXJtIiwiaiIsImdldFBhcmFtIiwiciIsImIiLCJpc0FycmF5IiwiX3R5cGVvZiIsImhhc093blByb3BlcnR5IiwiRGF0ZSIsInN1YnN0cmluZyIsIm9uU2Nyb2xsIiwic2NyY29scyIsInNjcm9sbExlZnQiLCJjb2xjb250c2Nyb2xsIiwicHJldmVudERlZmF1bHQiLCJlbCIsInQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJsIiwiZm9yRWFjaCIsIm1hcmdpblRvcCIsInNkIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImhlaWdodCIsInBhcnNlSW50IiwidGVzdCIsImRyYWdTdGFydCIsImRhdGFUcmFuc2ZlciIsImVmZmVjdEFsbG93ZWQiLCJzZXREYXRhIiwiZHJhZ0VudGVyIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJvcGFjaXR5IiwiZHJhZ0V4aXQiLCJzdG9wUHJvcGFnYXRpb24iLCJkcmFnRG93biIsInRhcmciLCJudW0yIiwiZHJhZ1N0b3AiLCJudW0iLCJhbGxvd0Ryb3AiXSwibWFwcGluZ3MiOiJBQUdBLGtPQUNBQSxVQUNFQyxHQUFJLGVBRE5ELFlBQ0VDLFlBSUlDLEtBQU1DLFFBRlZDLE1BQUFBLFdBQ0VDLE1BQVlDLFVBQUFDLGNBQUEsaUJBR05DLFVBQU9GLE1BQ1ZHLFFBTE9QLEtBQUFRLE1BT1ZGLFFBQUFBLEdBR0VHLFNBVlFULEtBQUFVLE9BYVZDLE1BQVMsV0FDUFgsR0FBTVUsR0FEQyxFQUVQRSxJQUVFLFFBR0VDLElBQUssU0FBU0MsR0FEaEJDLFFBQU9DLElBQUFGLEVBQ0xELElBQUtJLEdBQUFILEVBQUFJLElBQUEsSUFDSEgsR0FBQUEsR0FBQUEsT0FBQUksVUFBQUwsR0FBQSxHQUNBTSxLQUVBQSxJQUFBQSxTQUFBQSxHQUxHTCxRQUFBQyxJQUFBRixFQU9MTyxJQUFLSixHQUFBSCxFQUFBLElBQ0hDLFNBQVFDLElBQUlGLEVBQVosWUFDSUcsR0FBS0gsR0FDVEMsUUFBUUMsSUFBSU0sRUFBWixNQUNBRixLQUVBQSxLQUFBQSxXQWJHTCxRQUFBQyxJQUFBTSxFQUFBRixJQWdCSEwsSUFBQUEsV0FoQkcsR0FBQVEsS0FrQkxDLEtBQUssR0FBQUMsS0FBQUgsR0FDSEMsRUFBSUEsS0FBTUQsRUFBVkcsR0FFRUYsT0FBSUcsT0FLWEMsU0FBQTFCLFFBaENNMkIsU0FiQzNC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RXRGLEVBQUFBLE9BQVFDLE1BQUkyRixRQUFaLEdBQ0FyRSxFQUFBaUQsbUJBS0FxQixTQUFBLFNBQUF0RSxHQUNBQSxFQUFBb0IsT0FBQStDLFVBQUFDLFNBQUEsWUFDQTNGLFFBQUFDLElBQUEsUUFDQXNCLEVBQUFvQixPQUFBSCxNQUFBb0QsUUFBQSxHQUVBckUsRUFBQUEsaUJBQ0FBLEVBQUF1RSxtQkFFRkMsU0FBQSxTQUFBeEUsR0EvTUlQLEtBQUFKLFNBQUE0QixNQUFBb0QsUUFBQSxFQWlOTkMsUUFBVTVGLElBQUEsU0FFTkQsU0FBQUEsU0FBWXVCLEdBQ1pBLFFBQUVvQixJQUFPSCxPQUFNb0QsRUFBQUEsT0FBZmhELFdBQUFBLFdBQUFDLFFBR0Z0QixLQURBQSxHQUFFaUQsR0FBQUEsRUFBQUEsUUFDQXNCLEVBQUFBLFVBQUZILFNBQUEsV0F2TklLLEVBQUFBLEVBQUFwRCxVQTJOSjVDLElBQUFBLEdBQVFDLEVBQUk0QyxRQTNOUm9ELEVBQUFqRixLQUFBSixTQUFBaUMsUUE2Tk5xRCxFQUFVbEYsS0FBQXhCLE9BQUF5RyxFQUNSakcsU0FBUUMsSUFBSWtHLEVBQUFGLEVBQ1osSUFBQW5ELEdBQUE5QixLQUFBeEIsTUFDQXNELEdBQUFDLE9BQUlpRCxLQUFTckQsU0FBYkUsUUFBQSxHQUNBQyxFQUFBQyxPQUFPaUQsRUFBS04sRUFBQUEsR0FDVk0sS0FBQUEsVUFDRGhGLEtBQUF4QixPQUFBc0QsR0FFRHNELFVBQUlELFNBQVd0RCxHQUNmdEIsRUFBQWlEIiwiZmlsZSI6InBhZ2VzL2NvbXBhcmUtcGFnZS9jb21wYXJlLXBhZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBwcmctMTUgb24gMTcuMDguMjAxNi5cclxuICovXHJcbid1c2Ugc3RyaWN0JztcclxuUG9seW1lcih7XHJcbiAgaXM6ICdjb21wYXJlLXBhZ2UnLFxyXG4gIFxyXG4gIHByb3BlcnRpZXM6IHtcclxuICAgIGFwcFNlcnZpY2U6IHtcclxuICAgICAgdHlwZTogRWxlbWVudCxcclxuICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXBwU2VydmljZScpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgYWdncGFyYW1zOiBBcnJheSxcclxuICAgIG9hcnJheToge1xyXG4gICAgICB0eXBlOiBBcnJheSxcclxuICAgICAgbm90aWZ5OiB0cnVlLFxyXG4gICAgICAvLyB2YWx1ZTogW11cclxuICAgIH0sIFxyXG4gICAgb2JqZWN0czoge1xyXG4gICAgICB0eXBlOiBPYmplY3QsXHJcbiAgICAgIHZhbHVlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBfbGVuZ3RoPTA7XHJcbiAgICAgICAgdmFyIF9vPXt9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIGFkZDogZnVuY3Rpb24obyl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG8pO1xyXG4gICAgICAgICAgICBsZXQgaWQgPSBvLl9pZFsnJG9pZCddO1xyXG4gICAgICAgICAgICBfb1tpZF09T2JqZWN0LmFzc2lnbih7fSxvLHRydWUpO1xyXG4gICAgICAgICAgICBfbGVuZ3RoKys7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGVsOiBmdW5jdGlvbihvKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobyk7XHJcbiAgICAgICAgICAgIGxldCBpZCA9IG9bJyRvaWQnXTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coX28sJ08hJyk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBfb1tpZF07XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKF9vLCdPIScpO1xyXG4gICAgICAgICAgICBfbGVuZ3RoLS07XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgbGlzdDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coX28sX2xlbmd0aCk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBsZXQgYXJyID0gW11cclxuICAgICAgICAgICAgZm9yKGxldCBpIGluIF9vKXtcclxuICAgICAgICAgICAgICBhcnIucHVzaChfb1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtb3ZlSXRlbTogRWxlbWVudCxcclxuICAgIG92ZXJJdGVtOiBFbGVtZW50LFxyXG4gIH0sXHJcbiAgXHJcbiAgYXR0YWNoZWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsdGhpcy5jb250YWluZXJTY3JvbGwpO1xyXG4gIH0sXHJcbiAgXHJcbiAgX2FyckNoYW5nZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLiQudGl0bGVDb2wsICdvYnNlcnZlcicpO1xyXG4gICAgY29uc29sZS5sb2codGhpcy4kLnRpdGxlQ29sLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb2x1bW5UaXRsZScpLCAnb2JzZXJ2ZXInKTtcclxuICB9LFxyXG4gIFxyXG4gIHNlbE9iajogZnVuY3Rpb24oZSxkKXtcclxuICAgIGNvbnNvbGUubG9nKGQsJ2RhdGEnKTtcclxuICAgIGxldCBvID0ge1xyXG4gICAgICAgICAgbWV0aG9kOiAncmMuZmluZCcsXHJcbiAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgY21kTmFtZV92YWx1ZTogJ29iamVjdHMnLFxyXG4gICAgICAgICAgICBmaWx0ZXI6IHtfaWQ6IGQuZGF0YS5faWR9XHJcbiAgICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmFwcFNlcnZpY2Uuc2VuZEFqYXgobywge293bmVyOiB0aGlzLCBmdW5jOiAnZ2V0T2JqZWN0J30sICdMb2FkZWQnKTtcclxuICB9LFxyXG4gIFxyXG4gIHVuc2VsT2JqOiBmdW5jdGlvbihlLGQpe1xyXG4gICAgY29uc29sZS5sb2coJ3Vuc2VsJylcclxuICAgIHRoaXMub2JqZWN0cy5kZWwoZC5kYXRhLl9pZCk7XHJcbiAgICB0aGlzLmdldE9BcnJheSgpO1xyXG4gIH0sXHJcbiAgX2Nsb3NlU2VhcmNoOiBmdW5jdGlvbigpe1xyXG4gICAgbGV0IGNsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY29tcGFyZS1wYWdlOjpzaGFkb3cgLmNvbHVtbnMnKTtcclxuICAgIGlmKGNsLmNsaWVudFdpZHRoPGNsLnNjcm9sbFdpZHRoKXtcclxuICAgICAgbGV0IGNjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY29tcGFyZS1wYWdlOjpzaGFkb3cgI2NvbGNvbnRzY3JvbGwnKTtcclxuICAgICAgY2MucXVlcnlTZWxlY3RvcignZGl2Jykuc3R5bGUud2lkdGg9Y2wuc2Nyb2xsV2lkdGgrJ3B4JztcclxuICAgICAgbGV0IHN0ID0gY2wucXVlcnlTZWxlY3RvcignLmlwVGl0bGUnKTtcclxuICAgICAgY29uc29sZS5sb2coY2wsJ2NsJyk7XHJcbiAgICAgIGxldCBzaCA9IGNjLm9mZnNldEhlaWdodC1jYy5jbGllbnRIZWlnaHQ7XHJcbiAgICAgIGNjLnN0eWxlLnRvcD1zdC5jbGllbnRIZWlnaHQtc2grJ3B4JzsvL3N0KzQxMysncHgnOyBcclxuICAgICAgY2Muc3R5bGUuZGlzcGxheT0nYmxvY2snO1xyXG4gICAgfVxyXG4gICAgLy8gY29uc29sZS5kaXIoY2wpO1xyXG4gICAgLy8gY29uc29sZS5sb2coY2wuY2xpZW50V2lkdGgsY2wub2Zmc2V0V2lkdGgsJ3dkdCcpO1xyXG4gIH0sXHJcbiAgXHJcbiAgb2JqUmVtb3ZlOiBmdW5jdGlvbihlKXtcclxuICAgIGxldCBvPWUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZTsvLy5kYXRhQXJnO1xyXG4gICAgbGV0IGlkID0gby5kYXRhQXJnO1xyXG4gICAgbGV0IGEgPSB0aGlzLm9hcnJheTtcclxuICAgIGEuc3BsaWNlKGlkLDEpO1xyXG4gICAgY29uc29sZS5sb2coYSk7XHJcbiAgICB0aGlzLm9hcnJheSA9IFtdO1xyXG4gICAgdGhpcy5vYXJyYXkgPSBhO1xyXG4gIH0sXHJcbiAgZ2V0T2JqZWN0OiBmdW5jdGlvbihvKXtcclxuICAgIGNvbnNvbGUubG9nKG8sJ2ZpbmQnKTtcclxuICAgIGNvbnNvbGUubG9nKG8ucmVzdWx0LmN1cnNvci5maXJzdEJhdGNoWzBdKTtcclxuICAgIHRoaXMub2JqZWN0cy5hZGQoby5yZXN1bHQuY3Vyc29yLmZpcnN0QmF0Y2hbMF0pO1xyXG4gICAgdGhpcy5nZXRPQXJyYXkoKTtcclxuICB9LFxyXG4gIFxyXG4gIGdldE9BcnJheTogZnVuY3Rpb24oKXsgIFxyXG4gICAgdGhpcy5vYXJyYXkgPSB0aGlzLm9iamVjdHMuZ2V0KCk7XHJcbiAgICB0aGlzLmdldEFnZ1BhcmFtcygpO1xyXG4gICAgLy8gY29uc29sZS5sb2codGhpcy4kLmNvbGNvbnRzY3JvbGwsdGhpcy4kLnNjcmNvbHMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpO1xyXG4gICAgdGhpcy4kLmNvbGNvbnRzY3JvbGxkLnN0eWxlLndpZHRoID0gdGhpcy5vYXJyYXkubGVuZ3RoKjIwMisncHgnO1xyXG4gIH0sXHJcbiAgZ2V0QWdnUGFyYW1zOiBmdW5jdGlvbigpe1xyXG4gICAgbGV0IGEgPSB0aGlzLm9hcnJheTtcclxuICAgIGxldCBwcm0gPSBbXTtcclxuICAgIGlmKGEubGVuZ3RoPjApe1xyXG4gICAgICBsZXQgcGFybSA9IGFbMF0ub2JqZWN0O1xyXG4gICAgICBmb3IobGV0IGk9YS5sZW5ndGg7aS0tPjE7KXtcclxuICAgICAgICBmb3IobGV0IGogaW4gcGFybSl7XHJcbiAgICAgICAgICBpZihhW2ldLm9iamVjdFtqXT09PXVuZGVmaW5lZCl7ZGVsZXRlIHBhcm1bal19XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKHBhcm0pO1xyXG4gICAgICBmb3IobGV0IGkgaW4gcGFybSl7cHJtLnB1c2goaSl9XHJcbiAgICB9XHJcbiAgICB0aGlzLmFnZ3BhcmFtcyA9IHBybTtcclxuICB9LFxyXG4gIGdldFBhcmFtOiBmdW5jdGlvbihhLGIpe1xyXG4gICAgLy8gY29uc29sZS5sb2coYVtiXSwnVmFyaWFibGVzJyk7IFxyXG4gICAgbGV0IHI9KGFbYl0hPScnKT9hW2JdOifQvdC1INC30LDQtNCw0L3Qvic7XHJcbiAgICBpZihBcnJheS5pc0FycmF5KHIpKXtyPSdBcnJheSd9XHJcbiAgICBpZih0eXBlb2Ygcj09J29iamVjdCcmJnIuaGFzT3duUHJvcGVydHkoJyRkYXRlJykpe1xyXG4gICAgICBsZXQgZD1uZXcgRGF0ZShyWyckZGF0ZSddKVxyXG4gICAgICByPWQudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHI7XHJcbiAgfSxcclxuICBcclxuICBvblNjcm9sbDogZnVuY3Rpb24oZSl7XHJcbiAgICB0aGlzLiQuc2NyY29scy5zY3JvbGxMZWZ0PXRoaXMuJC5jb2xjb250c2Nyb2xsLnNjcm9sbExlZnQ7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgfSxcclxuICBjb250YWluZXJTY3JvbGw6IGZ1bmN0aW9uKGUpe1xyXG4gICAgbGV0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY29tcGFyZS1wYWdlOjpzaGFkb3cgLmNvbHVtbnMnKTsvLy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIGxldCB0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xyXG4gICAgbGV0IGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdjb21wYXJlLXBhZ2U6OnNoYWRvdyAuY29sdW1uJyk7XHJcbiAgICBpZiAodDw9NTApey8vJiYhbC5jbGFzc0xpc3QuY29udGFpbnMoJ0JvYXQnKSl7XHJcbiAgICAgIGwuZm9yRWFjaChmdW5jdGlvbihpKXtcclxuICAgICAgICBpLnF1ZXJ5U2VsZWN0b3IoJy5pcFRpdGxlJykuc3R5bGUubWFyZ2luVG9wPTUwLXQrJ3B4JztcclxuICAgICAgICAvLyBlbC5xdWVyeVNlbGVjdG9yKCcjY29sY29udHNjcm9sbCcpLnN0eWxlLnRvcD0yMDAtdCsncHgnO1xyXG4gICAgICAgIGkucXVlcnlTZWxlY3RvcignLnByb3BOYW1lcycpLnN0eWxlLm1hcmdpblRvcD10LTUwKydweCc7XHJcbiAgICAgIH0pO1xyXG4gICAgICBsZXQgc2QgPSBlbC5xdWVyeVNlbGVjdG9yKCcjY29sY29udHNjcm9sbCcpO1xyXG4gICAgICBsZXQgc3QgPSBsWzBdLnF1ZXJ5U2VsZWN0b3IoJy5pcFRpdGxlJyk7XHJcbiAgICAgIGxldCBzaCA9IHNkLm9mZnNldEhlaWdodC1zZC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgIHNkLnN0eWxlLnRvcD1zdC5jbGllbnRIZWlnaHQrNTAtdC1zaCsncHgnOy8vc3QrNDEzKydweCc7IFxyXG4gICAgfVxyXG4gICAgaWYgKHQ+NTApey8vJiYhbC5jbGFzc0xpc3QuY29udGFpbnMoJ0JvYXQnKSl7XHJcbiAgICAgIC8vIGNvbnNvbGUuZGlyKHNoLCdzdCcpOyBcclxuICAgICAgbC5mb3JFYWNoKGZ1bmN0aW9uKGkpe1xyXG4gICAgICAgIGkucXVlcnlTZWxlY3RvcignLmlwVGl0bGUnKS5zdHlsZS5tYXJnaW5Ub3A9MDtcclxuICAgICAgICAvLyBlbC5xdWVyeVNlbGVjdG9yKCcjY29sY29udHNjcm9sbCcpLnN0eWxlLnRvcD0yMDAtdCsncHgnO1xyXG4gICAgICAgIGkucXVlcnlTZWxlY3RvcignLnByb3BOYW1lcycpLnN0eWxlLm1hcmdpblRvcD0wO1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IHNkID0gZWwucXVlcnlTZWxlY3RvcignI2NvbGNvbnRzY3JvbGwnKTtcclxuICAgICAgbGV0IHN0ID0gZ2V0Q29tcHV0ZWRTdHlsZShsWzBdLnF1ZXJ5U2VsZWN0b3IoJy5pcFRpdGxlJykpLmhlaWdodDtcclxuICAgICAgbGV0IHNoID0gc2Qub2Zmc2V0SGVpZ2h0LXNkLmNsaWVudEhlaWdodDtcclxuICAgICAgc2Quc3R5bGUudG9wPXBhcnNlSW50KHN0KS1zaCsncHgnO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgXHJcbiAgdGVzdDpmdW5jdGlvbihvKXtcclxuICAgIGNvbnNvbGUuZGlyKG8pO1xyXG4gIH0sXHJcbiAgZHJhZ1N0YXJ0OiBmdW5jdGlvbihlKXtcclxuICAgIC8vIGNvbnNvbGUubG9nKGUudGFyZ2V0LmNsYXNzTGlzdCk7XHJcbiAgICB0aGlzLm1vdmVJdGVtID0gZS50YXJnZXQ7IFxyXG4gICAgLy8gdGhpcy5tb3ZlSXRlbS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9J2xpZ2h0Z3JheSc7XHJcbiAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gXCJjb3B5XCI7XHJcbiAgICAvLyBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ21vdmUnO1xyXG4gICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgndGV4dC9odG1sJywgZS50YXJnZXQpO1xyXG4gICAgLy8gZS50YXJnZXQuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjtcclxuICB9LFxyXG4gIGRyYWdFbnRlcjogZnVuY3Rpb24oZSl7XHJcbiAgICAvLyBlLmNhbmNlbEJ1YmJsZT10cnVlO1xyXG4gICAgLy8gY29uc29sZS5sb2coZS50YXJnZXQsJz8nKVxyXG4gICAgLy8gaWYoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2x1bW4nKSYmKHRoaXMub3Zlckl0ZW09PT11bmRlZmluZWR8fGUudGFyZ2V0LmRhdGFBcmchPXRoaXMub3Zlckl0ZW0uZGF0YUFyZykpe1xyXG4gICAgaWYoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2x1bW4nKSl7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdlbnRlcicpO1xyXG4gICAgICAvLyBpZih0aGlzLm92ZXJJdGVtIT11bmRlZmluZWQpe1xyXG4gICAgICAvLyAgIC8vIHRoaXMub3Zlckl0ZW0uc3R5bGUuYm9yZGVyPScwJztcclxuICAgICAgLy8gICB0aGlzLm92ZXJJdGVtLnN0eWxlLm9wYWNpdHk9MTsgIFxyXG4gICAgICAvLyAgIHRoaXMub3Zlckl0ZW0uc3R5bGUubWFyZ2luTGVmdD0nMCc7XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gdGhpcy5vdmVySXRlbSA9IGUudGFyZ2V0O1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLm92ZXJJdGVtKTtcclxuICAgICAgLy8gdGhpcy5vdmVySXRlbS5zdHlsZS5tYXJnaW5MZWZ0PScyMDBweCc7XHJcbiAgICAgIC8vIHRoaXMub3Zlckl0ZW0uc3R5bGUuYm9yZGVyPScxcHggZG90dGVkIGxpbWUnOyAgXHJcbiAgICAgIGUudGFyZ2V0LnN0eWxlLm9wYWNpdHk9MC40OyAgXHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgLy8gZS5jYVxyXG4gICAgfVxyXG4gICAgLy8gcmV0dXJuIGZhbHNlO1xyXG4gIH0sXHJcbiAgZHJhZ0V4aXQ6IGZ1bmN0aW9uKGUpe1xyXG4gICAgaWYoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb2x1bW4nKSl7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdleGl0Jyk7XHJcbiAgICAgIGUudGFyZ2V0LnN0eWxlLm9wYWNpdHk9MTsgXHJcbiAgICB9XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gIH0sXHJcbiAgZHJhZ0Rvd246IGZ1bmN0aW9uKGUpe1xyXG4gICAgdGhpcy5tb3ZlSXRlbS5zdHlsZS5vcGFjaXR5PTE7XHJcbiAgICBjb25zb2xlLmxvZygnZG93bicpO1xyXG4gIH0sXHJcbiAgZHJhZ1N0b3A6IGZ1bmN0aW9uKGUpe1xyXG4gICAgY29uc29sZS5sb2coJ2Ryb3AnLGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5kYXRhQXJnKTtcclxuICAgIC8vIHRoaXMubW92ZUl0ZW0uc3R5bGUuZGlzcGxheVxyXG4gICAgbGV0IHRhcmcgPSBlLnRhcmdldDtcclxuICAgIHdoaWxlKCF0YXJnLmNsYXNzTGlzdC5jb250YWlucygnY29sdW1uJykpe1xyXG4gICAgICB0YXJnPXRhcmcucGFyZW50Tm9kZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgbGV0IG51bSA9IHRhcmcuZGF0YUFyZztcclxuICAgIGxldCBudW0yID0gdGhpcy5tb3ZlSXRlbS5kYXRhQXJnXHJcbiAgICBsZXQgZWwgPSB0aGlzLm9hcnJheVtudW0yXTtcclxuICAgIGNvbnNvbGUubG9nKG51bSxudW0yKTtcclxuICAgIGxldCBhID0gdGhpcy5vYXJyYXk7XHJcbiAgICBhLnNwbGljZSh0aGlzLm1vdmVJdGVtLmRhdGFBcmcsMSk7XHJcbiAgICBhLnNwbGljZShudW0sMCxlbCk7XHJcbiAgICB0aGlzLm9hcnJheSA9IFtdO1xyXG4gICAgdGhpcy5vYXJyYXkgPSBhO1xyXG4gIH0sXHJcbiAgYWxsb3dEcm9wOiBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICB9XHJcblxyXG59KTtcclxuIl19
