"use strict";Polymer({is:"object-search",properties:{appService:{type:Element,value:function(){return document.querySelector("#appService")}},multiSelect:{type:Boolean,value:function(){var t=this.getAttribute("multi");return null!==t&&"false"!=t.toLowerCase()}},prototypes:Array,prototypesShow:Array,prototypesNum:{type:Number,value:0},objects:Array,objectsShow:{type:Array,observer:"_selectObjectStatus"},objectsNum:{type:Number,value:0},searchString:String,selectPattern:String,parameters:Array,loadsCount:{type:Number,value:12},loading:{type:Boolean,value:!1},isSelected:{type:Boolean,value:!1},switcher:Array,storager:Element},attached:function(){console.log("multi",this.multiSelect)},_selectPatternStatus:function(){this.$.patternsSearchList.querySelectorAll(".selected")},_selectObjectStatus:function(){this.$.objectsSearchList.querySelectorAll("paper-button")},_checkSwitch:function(){0==this.prototypesNum?this.switcher[0].disabled=!0:this.switcher[0].disabled=!1,0==this.objectsNum?this.switcher[2].disabled=!0:this.switcher[2].disabled=!1,void 0!==this.prototypes&&this.prototypes.length<10?this.switcher[1].disabled=!0:this.switcher[1].disabled=!1,void 0!==this.objects&&this.objects.length<10?this.switcher[3].disabled=!0:this.switcher[3].disabled=!1},openSearchDialog:function(){this.$.searchDialog.open(),this.switcher=Polymer.dom(this.root).querySelectorAll(".move-search-items paper-icon-button"),this.prototypeSearch()},switchPatternUp:function(){this.prototypesNum--,this.prototypeSearch()},switchPatternDown:function(){this.prototypesNum++,this.prototypeSearch()},switchObjectsUp:function(){this.objectsNum--,this.objectsGetBase()},switchObjectsDown:function(){this.objectsNum++,this.objectsGetBase()},load:function(t,e){this.loading=!0,this.appService.sendAjax(t,{owner:this,func:e},"Loaded")},receivedPatterns:function(t){this.loading=!1,this.prototypes=t.result.cursor.firstBatch,this.prototypesShow=this.prototypes,this._checkSwitch(),this.objectsGetBase()},receivedObjects:function(t){console.log(t),this.loading=!1,this.objects=t.result.cursor.firstBatch,this.objectsShow=this.objects,this._checkSwitch()},selectPrototype:function(t){t.target.classList.toggle("selected"),this.getParameters(),this.objectsGetBase()},getParameters:function(){var t=this.$.patternsSearchList.querySelectorAll(".selected");if(t.length>0){for(var e=Object.assign({},t[0].dataHost.item.schema.properties,!0),s=t.length;s-- >0;){var o=t[s].dataHost.item.schema.properties;for(var i in e)void 0!==o[i]?o[i].type!=e[i].type&&delete e[i]:delete e[i]}var r=[];for(var a in e)r.push(a);this.parameters=r,this.isSelected=!0}else this.parameters=[],this.isSelected=!1},_search:function(t,e){for(var s=[],o="o"==e?this.objects:this.prototypes,i=new RegExp(t,"i"),r=0;r<o.length;r++)i.test(o[r].meta.name)&&s.push(o[r]);"o"==e?this.objectsShow=s:this.prototypesShow=s},patternSearch:function(t){this.prototypesNum=0,this.prototypeSearch(t.target.value)},objectSearch:function(t){this.objectsNum=0,this.objectsGetBase(t.target.value)},paramsSearch:function(){},prototypeSearch:function(){var t=this.$.patternSearchField.value,e={method:"rc.find",params:{cmdName_value:"patterns",projection:{additional:0},skip:this.prototypesNum*this.loadsCount,limit:this.loadsCount}};t&&(e.params.filter={"meta.name":{$regex:t,$options:"im"}}),this.load(e,"receivedPatterns")},openObjects:function(t){var e=this._toggle(t);e&&void 0===this.objects&&this.objectsGetBase()},objectsGetBase:function(){var t=this.$.objectSearchField.value,e=this.$.patternsSearchList.querySelectorAll(".selected"),s=[],o=[];if(e.forEach(function(t){s.push(t.dataHost.item._id)}),void 0!==this.$.expandParamsSearch){var i=this.$.expandParamsSearch.querySelectorAll(".search-object-params");i.forEach(function(t){if(""!=t.value){var e={};e.key=t.label,e.value=t.value,o.push(e)}})}var r={method:"rc.find",params:{cmdName_value:"objects",filter:{"meta.non_system":!1},projection:{_id:1,meta:1},skip:this.objectsNum*this.loadsCount,limit:this.loadsCount}};if(t&&(r.params.filter["meta.name"]={$regex:t,$options:"im"}),s.length>0&&(r.params.filter["meta.pattern"]={$in:s}),o.length>0)for(var a=o.length;a-- >0;)r.params.filter["object."+o[a].key]={$regex:o[a].value,$options:"im"};console.log(r),this.load(r,"receivedObjects")},selectObject:function(t){console.log("selectObject");var e=t.target.dataHost.item,s={name:"selectObject",data:e};this.multiSelect?(t.target.classList.contains("selected")?this.fire("unselectobject",s):this.fire("selectobject",s),t.target.classList.toggle("selected")):(this.$.searchDialog.close(),this.fire("selectobject",s))},isPrototypeSelected:function(){return!(this.$.patternsSearchList.querySelectorAll(".selected").length>0)},_toggle:function(t){var e=Polymer.dom(t).localTarget.parentNode,s=Polymer.dom(e).parentNode.querySelector("iron-collapse");return s.toggle(),s.opened},getEventItemId:function(t){return t.model.item._id.$oid}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVsZW1lbnRzL29iamVjdC1zZWFyY2gvb2JqZWN0LXNlYXJjaC5qcyJdLCJuYW1lcyI6WyJQb2x5bWVyIiwiaXMiLCJwcm9wZXJ0aWVzIiwiYXBwU2VydmljZSIsInR5cGUiLCJFbGVtZW50IiwidmFsdWUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJtdWx0aVNlbGVjdCIsIkJvb2xlYW4iLCJtIiwidGhpcyIsImdldEF0dHJpYnV0ZSIsInRvTG93ZXJDYXNlIiwicHJvdG90eXBlcyIsIkFycmF5IiwicHJvdG90eXBlc1Nob3ciLCJwcm90b3R5cGVzTnVtIiwiTnVtYmVyIiwib2JqZWN0cyIsIm9iamVjdHNTaG93Iiwib2JzZXJ2ZXIiLCJvYmplY3RzTnVtIiwic2VhcmNoU3RyaW5nIiwiU3RyaW5nIiwic2VsZWN0UGF0dGVybiIsInBhcmFtZXRlcnMiLCJsb2Fkc0NvdW50IiwibG9hZGluZyIsImlzU2VsZWN0ZWQiLCJzd2l0Y2hlciIsInN0b3JhZ2VyIiwiYXR0YWNoZWQiLCJjb25zb2xlIiwibG9nIiwiX3NlbGVjdFBhdHRlcm5TdGF0dXMiLCIkIiwicGF0dGVybnNTZWFyY2hMaXN0IiwicXVlcnlTZWxlY3RvckFsbCIsIl9zZWxlY3RPYmplY3RTdGF0dXMiLCJvYmplY3RzU2VhcmNoTGlzdCIsIl9jaGVja1N3aXRjaCIsImRpc2FibGVkIiwidW5kZWZpbmVkIiwibGVuZ3RoIiwib3BlblNlYXJjaERpYWxvZyIsInNlYXJjaERpYWxvZyIsIm9wZW4iLCJkb20iLCJyb290IiwicHJvdG90eXBlU2VhcmNoIiwic3dpdGNoUGF0dGVyblVwIiwic3dpdGNoUGF0dGVybkRvd24iLCJzd2l0Y2hPYmplY3RzVXAiLCJzd2l0Y2hPYmplY3RzRG93biIsImxvYWQiLCJvYmplY3RzR2V0QmFzZSIsIm9iaiIsImZ1biIsInJlY2VpdmVkUGF0dGVybnMiLCJzZW5kQWpheCIsIm93bmVyIiwiZnVuYyIsIm8iLCJyZXN1bHQiLCJjdXJzb3IiLCJmaXJzdEJhdGNoIiwicmVjZWl2ZWRPYmplY3RzIiwic2VsZWN0UHJvdG90eXBlIiwiZSIsInRhcmdldCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImdldFBhcmFtZXRlcnMiLCJzZWxlY3RfcGF0dGVybnMiLCJhc3NpZ24iLCJzY2hlbWEiLCJwYXJtIiwiaiIsImRhdGFIb3N0IiwiaXRlbSIsInBybSIsImkiLCJwYXJtX2FyciIsInB1c2giLCJsIiwiX3NlYXJjaCIsIm5yIiwic1MiLCJhciIsInJnIiwiUmVnRXhwIiwidGVzdCIsIm5hbWUiLCJtZXRhIiwicGF0dGVyblNlYXJjaCIsIm9iamVjdFNlYXJjaCIsInBhcmFtc1NlYXJjaCIsInNXIiwicGF0dGVyblNlYXJjaEZpZWxkIiwibWV0aG9kIiwicGFyYW1zIiwiY21kTmFtZV92YWx1ZSIsInByb2plY3Rpb24iLCJhZGRpdGlvbmFsIiwic2tpcCIsImxpbWl0IiwiZmlsdGVyIiwibWV0YS5uYW1lIiwiJHJlZ2V4IiwiJG9wdGlvbnMiLCJvcGVuT2JqZWN0cyIsInIiLCJzZWxlY3RzIiwidiIsIl9pZCIsImV4cGFuZFBhcmFtc1NlYXJjaCIsInNlbGVjdF9wYXJhbXMiLCJmb3JFYWNoIiwibGFiZWwiLCJrZXkiLCIkaW4iLCJzZWxlY3RPYmplY3QiLCJmaXJlIiwiY2xvc2UiLCJpc1Byb3RvdHlwZVNlbGVjdGVkIiwiX3RvZ2dsZSIsImV2ZW50IiwiYnV0dG9uVG9nZ2xlIiwibG9jYWxUYXJnZXQiLCJwYXJlbnROb2RlIiwiZGVzY3JpYmUiLCJvcGVuZWQiLCJnZXRFdmVudEl0ZW1JZCIsIm1vZGVsIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBQSxVQUNFQyxHQUFJLGdCQUVKQyxZQUNFQyxZQUNJQyxLQUFNQyxRQUNOQyxNQUFPLFdBQ0gsTUFBT0MsVUFBU0MsY0FBYyxpQkFHdENDLGFBQ0VMLEtBQU1NLFFBQ05KLE1BQU8sV0FDTCxHQUFJSyxHQUFJQyxLQUFLQyxhQUFhLFFBQzFCLE9BQVFGLFFBQUFBLEdBQVUsU0FBVkEsRUFBQUcsZ0JBR1pDLFdBQVlDLE1BQ1pD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LElBQU9NLEdBQ1poRyxLQUFBNEMsS0FBQUUsRUFBQSxvQkFHSGlFLGFBQUEsU0FBY3JELEdBalJkcEMsUUFBQUMsSUFBQSxlQXNSQSxJQUFJOEMsR0FBT1gsRUFBRUMsT0FBT1MsU0FBU0MsS0FGakMwQyxHQUNZeEYsS0FBSSxlQUNSOEMsS0FBU1YsRUFFSDNELE1BQUFILGFBQ0F3RSxFQUFBQSxPQUFBQSxVQUFBQSxTQUFBQSxZQUdDVixLQUFPQyxLQUFBQSxpQkFBbUJQLEdBTHJDckQsS0FBQWdILEtBQUEsZUFBQTNELEdBS0lLLEVBRU9DLE9BQUFDLFVBQUFDLE9BQUEsY0FHTEYsS0FBT0MsRUFBQUEsYUFBaUJxRCxRQUV6QmpILEtBQUFnSCxLQUFBLGVBQUEzRCxLQUlWNkQsb0JBdlNLLFdBeVNQQSxRQUFBQSxLQUFBQSxFQUFBQSxtQkFBcUJ2RixpQkFBVSxhQUFBTSxPQUFBLElBRzlCa0YsUUE1U00sU0FBQUMsR0ErU0YsR0FBSUMsR0FBZWpJLFFBQVFpRCxJQUFJK0UsR0FBT0UsWUFBWUMsV0FBOUNGLEVBQUFBLFFBQWVqSSxJQUFRaUQsR0FBV2lGLFdBQVlDLGNBQWxELGdCQUdBLE9BREFDLEdBQUlBLFNBQ0pBLEVBQUFDLFFBS0hDLGVBdlRLLFNBQUFOLEdBeVROTSxNQUFBQSxHQUFnQkMsTUFBQXRELEtBQUFtQyxJQUFoQmtCIiwiZmlsZSI6ImVsZW1lbnRzL29iamVjdC1zZWFyY2gvb2JqZWN0LXNlYXJjaC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcblBvbHltZXIoe1xyXG4gIGlzOiAnb2JqZWN0LXNlYXJjaCcsXHJcblxyXG4gIHByb3BlcnRpZXM6IHtcclxuICAgIGFwcFNlcnZpY2U6IHtcclxuICAgICAgICB0eXBlOiBFbGVtZW50LFxyXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjYXBwU2VydmljZScpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtdWx0aVNlbGVjdDoge1xyXG4gICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICB2YWx1ZTogZnVuY3Rpb24oKXtcclxuICAgICAgICBsZXQgbSA9IHRoaXMuZ2V0QXR0cmlidXRlKCdtdWx0aScpO1xyXG4gICAgICAgIHJldHVybiAobSE9PW51bGwmJm0udG9Mb3dlckNhc2UoKSE9J2ZhbHNlJyk/dHJ1ZTpmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHByb3RvdHlwZXM6IEFycmF5LFxyXG4gICAgcHJvdG90eXBlc1Nob3c6IEFycmF5LFxyXG4gICAgcHJvdG90eXBlc051bToge1xyXG4gICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgIHZhbHVlOiAwXHJcbiAgICB9LFxyXG4gICAgb2JqZWN0czogQXJyYXksXHJcbiAgICBvYmplY3RzU2hvdzoge1xyXG4gICAgICB0eXBlOiBBcnJheSxcclxuICAgICAgb2JzZXJ2ZXI6ICdfc2VsZWN0T2JqZWN0U3RhdHVzJ1xyXG4gICAgfSxcclxuICAgIG9iamVjdHNOdW06IHtcclxuICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICB2YWx1ZTogMFxyXG4gICAgfSwgXHJcbiAgICBzZWFyY2hTdHJpbmc6IFN0cmluZyxcclxuICAgIHNlbGVjdFBhdHRlcm46IFN0cmluZyxcclxuICAgIHBhcmFtZXRlcnM6IEFycmF5LFxyXG4gICAgXHJcbiAgICBsb2Fkc0NvdW50OiB7XHJcbiAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgdmFsdWU6IDEyXHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICBsb2FkaW5nOiB7XHJcbiAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgIHZhbHVlOiBmYWxzZVxyXG4gICAgfSxcclxuICAgIGlzU2VsZWN0ZWQ6IHtcclxuICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgdmFsdWU6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgc3dpdGNoZXI6IEFycmF5LFxyXG4gICAgc3RvcmFnZXI6IEVsZW1lbnQsXHJcbiAgfSxcclxuXHJcbiAgYXR0YWNoZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgICBjb25zb2xlLmxvZygnbXVsdGknLCB0aGlzLm11bHRpU2VsZWN0KTtcclxuICAgIC8vIHRoaXMuZGlzYWJsZT1bJ2Rpc2FibGVkJywnJywnZGlzYWJsZWQnLCcnXTtcclxuICB9LFxyXG4gIFxyXG4gIF9zZWxlY3RQYXR0ZXJuU3RhdHVzOiBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy4kLnBhdHRlcm5zU2VhcmNoTGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0ZWQnKTtcclxuICAgIFxyXG4gIH0sXHJcbiAgX3NlbGVjdE9iamVjdFN0YXR1czogZnVuY3Rpb24oKXtcclxuICAgIGxldCBvYmpzID0gdGhpcy4kLm9iamVjdHNTZWFyY2hMaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ3BhcGVyLWJ1dHRvbicpO1xyXG4gICAgLy8gb2Jqcy5mb3JFYWNoKGZ1bmN0aW9uKGkpe1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhpLCdCdXR0b25zIG9iaicpO1xyXG4gICAgLy8gfSk7XHJcbiAgICBcclxuICB9LCAgXHJcbiAgX2NoZWNrU3dpdGNoOiBmdW5jdGlvbigpe1xyXG4gICAgICBpZih0aGlzLnByb3RvdHlwZXNOdW09PTApe1xyXG4gICAgICAgIHRoaXMuc3dpdGNoZXJbMF0uZGlzYWJsZWQ9dHJ1ZTsgXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMuc3dpdGNoZXJbMF0uZGlzYWJsZWQ9ZmFsc2U7IFxyXG4gICAgICB9XHJcbiAgICAgIGlmKHRoaXMub2JqZWN0c051bT09MCl7IFxyXG4gICAgICAgIHRoaXMuc3dpdGNoZXJbMl0uZGlzYWJsZWQ9dHJ1ZTsgXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIHRoaXMuc3dpdGNoZXJbMl0uZGlzYWJsZWQ9ZmFsc2U7IFxyXG4gICAgICB9XHJcbiAgICAgIGlmKHRoaXMucHJvdG90eXBlcyE9PXVuZGVmaW5lZCYmdGhpcy5wcm90b3R5cGVzLmxlbmd0aDwxMCl7XHJcbiAgICAgICAgdGhpcy5zd2l0Y2hlclsxXS5kaXNhYmxlZD10cnVlOyBcclxuICAgICAgfWVsc2V7XHJcbiAgICAgICAgdGhpcy5zd2l0Y2hlclsxXS5kaXNhYmxlZD1mYWxzZTsgXHJcbiAgICAgIH1cclxuICAgICAgaWYodGhpcy5vYmplY3RzIT09dW5kZWZpbmVkJiZ0aGlzLm9iamVjdHMubGVuZ3RoPDEwKXtcclxuICAgICAgICB0aGlzLnN3aXRjaGVyWzNdLmRpc2FibGVkPXRydWU7IFxyXG4gICAgICB9ZWxzZXtcclxuICAgICAgICB0aGlzLnN3aXRjaGVyWzNdLmRpc2FibGVkPWZhbHNlOyBcclxuICAgICAgfVxyXG4gICAgXHJcbiAgfSxcclxuXHJcbiAgb3BlblNlYXJjaERpYWxvZzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAvLyB0aGlzLmZpcmUoJ3NlbGVjdG9iamVjdCcse25hbWU6J3NlbGVjdE9iamVjdCcsZGF0YTpudWxsfSk7IFxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhQb2x5bWVyLmRvbSh0aGlzLnJvb3QpKTtcclxuICAgICAgdGhpcy4kLnNlYXJjaERpYWxvZy5vcGVuKCk7XHJcbiAgICAgIHRoaXMuc3dpdGNoZXIgPSBQb2x5bWVyLmRvbSh0aGlzLnJvb3QpLnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb3ZlLXNlYXJjaC1pdGVtcyBwYXBlci1pY29uLWJ1dHRvbicpO1xyXG4gICAgICB0aGlzLnByb3RvdHlwZVNlYXJjaCgpO1xyXG4gICAgICAvLyB0aGlzLm9iamVjdHNHZXRCYXNlKCk7XHJcbiAgfSxcclxuICBcclxuICBzd2l0Y2hQYXR0ZXJuVXA6IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLnByb3RvdHlwZXNOdW0tLTtcclxuICAgIHRoaXMucHJvdG90eXBlU2VhcmNoKCk7XHJcbiAgfSxcclxuICBzd2l0Y2hQYXR0ZXJuRG93bjogZnVuY3Rpb24oKXtcclxuICAgIHRoaXMucHJvdG90eXBlc051bSsrO1xyXG4gICAgdGhpcy5wcm90b3R5cGVTZWFyY2goKTtcclxuICB9LFxyXG4gIHN3aXRjaE9iamVjdHNVcDogZnVuY3Rpb24oKXtcclxuICAgIHRoaXMub2JqZWN0c051bS0tO1xyXG4gICAgdGhpcy5vYmplY3RzR2V0QmFzZSgpO1xyXG4gIH0sXHJcbiAgc3dpdGNoT2JqZWN0c0Rvd246IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLm9iamVjdHNOdW0rKztcclxuICAgIHRoaXMub2JqZWN0c0dldEJhc2UoKTtcclxuICB9LFxyXG5cclxuICBsb2FkOiBmdW5jdGlvbihvYmosZnVuKXtcclxuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XHJcbiAgICAvLyB0aGlzLnN0b3JhZ2VyLmFkZFN0YWNrKCdyZWFkeVRvU2VuZCcsb2JqLCB7b3duZXI6IHRoaXMsIGZ1bmM6J3JlY2VpdmVkUGF0dGVybnMnfSk7XHJcbiAgICAvLyB0aGlzLnN0b3JhZ2VyLmFkZFN0YWNrKCdyZWFkeVRvU2VuZCcsb2JqLCB7b3duZXI6IHRoaXMsIGZ1bmM6ZnVufSk7XHJcbiAgICB0aGlzLmFwcFNlcnZpY2Uuc2VuZEFqYXgob2JqLCB7b3duZXI6IHRoaXMsIGZ1bmM6IGZ1bn0sICdMb2FkZWQnKTtcclxuICB9LFxyXG4gIFxyXG4gIHJlY2VpdmVkUGF0dGVybnM6IGZ1bmN0aW9uKG8pe1xyXG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLnByb3RvdHlwZXMgPSBvLnJlc3VsdC5jdXJzb3IuZmlyc3RCYXRjaDtcclxuICAgIHRoaXMucHJvdG90eXBlc1Nob3cgPSB0aGlzLnByb3RvdHlwZXM7XHJcbiAgICB0aGlzLl9jaGVja1N3aXRjaCgpO1xyXG4gICAgdGhpcy5vYmplY3RzR2V0QmFzZSgpO1xyXG59LFxyXG4gIHJlY2VpdmVkT2JqZWN0czogZnVuY3Rpb24obyl7XHJcbiAgICBjb25zb2xlLmxvZyhvKTtcclxuICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5vYmplY3RzID0gby5yZXN1bHQuY3Vyc29yLmZpcnN0QmF0Y2g7XHJcbiAgICB0aGlzLm9iamVjdHNTaG93ID0gdGhpcy5vYmplY3RzO1xyXG4gICAgLy8gdGhpcy5fc2VhcmNoKHRoaXMuJC5vYmplY3RTZWFyY2hGaWVsZC52YWx1ZSwnbycpO1xyXG4gICAgdGhpcy5fY2hlY2tTd2l0Y2goKTtcclxuICB9LFxyXG4gIFxyXG4gIHNlbGVjdFByb3RvdHlwZTogZnVuY3Rpb24oZSl7XHJcbiAgICBlLnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdzZWxlY3RlZCcpO1xyXG4gICAgdGhpcy5nZXRQYXJhbWV0ZXJzKCk7XHJcbiAgICB0aGlzLm9iamVjdHNHZXRCYXNlKCk7XHJcbiAgfSxcclxuICBcclxuICBnZXRQYXJhbWV0ZXJzOiBmdW5jdGlvbigpe1xyXG4gICAgbGV0IHNlbGVjdF9wYXR0ZXJucyA9IHRoaXMuJC5wYXR0ZXJuc1NlYXJjaExpc3QucXVlcnlTZWxlY3RvckFsbCgnLnNlbGVjdGVkJyk7XHJcbiAgICAvLyBjb25zb2xlLmxvZygnc2VsczonLHNlbGVjdF9wYXR0ZXJucy5sZW5ndGgpO1xyXG4gICAgaWYoc2VsZWN0X3BhdHRlcm5zLmxlbmd0aD4wKXtcclxuICAgICAgbGV0IHBhcm0gPSBPYmplY3QuYXNzaWduKHt9LHNlbGVjdF9wYXR0ZXJuc1swXS5kYXRhSG9zdC5pdGVtLnNjaGVtYS5wcm9wZXJ0aWVzLHRydWUpO1xyXG4gICAgICBmb3IobGV0IGkgPSBzZWxlY3RfcGF0dGVybnMubGVuZ3RoO2ktLT4wOyl7XHJcbiAgICAgICAgbGV0IHBybSA9IHNlbGVjdF9wYXR0ZXJuc1tpXS5kYXRhSG9zdC5pdGVtLnNjaGVtYS5wcm9wZXJ0aWVzO1xyXG4gICAgICAgIGZvcihsZXQgaiBpbiBwYXJtKXtcclxuICAgICAgICAgIGlmKHBybVtqXSE9PXVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIGlmKHBybVtqXS50eXBlIT1wYXJtW2pdLnR5cGUpe1xyXG4gICAgICAgICAgICAgIGRlbGV0ZSBwYXJtW2pdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZGVsZXRlIHBhcm1bal07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgbGV0IHBhcm1fYXJyID0gW107IFxyXG4gICAgICBmb3IobGV0IGwgaW4gcGFybSl7cGFybV9hcnIucHVzaChsKTt9XHJcbiAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcm1fYXJyO1xyXG4gICAgICB0aGlzLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnBhcmFtZXRlcnMscGFybSk7XHJcbiAgICB9ZWxzZXtcclxuICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gW107XHJcbiAgICAgIHRoaXMuaXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIF9zZWFyY2g6IGZ1bmN0aW9uKHNTLHR5cGUpe1xyXG4gICAgbGV0IG5yID0gIFtdO1xyXG4gICAgbGV0IGFyPSh0eXBlPT0nbycpP3RoaXMub2JqZWN0czp0aGlzLnByb3RvdHlwZXM7XHJcbiAgICBsZXQgcmcgPSBuZXcgUmVnRXhwKHNTLCdpJyk7XHJcbiAgICBmb3IobGV0IGkgPSAwO2k8YXIubGVuZ3RoO2krKyl7XHJcbiAgICAgIGlmKHJnLnRlc3QoYXJbaV0ubWV0YS5uYW1lKSl7bnIucHVzaChhcltpXSl9XHJcbiAgICB9XHJcbiAgICBpZih0eXBlPT0nbycpe1xyXG4gICAgICB0aGlzLm9iamVjdHNTaG93PW5yO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgIHRoaXMucHJvdG90eXBlc1Nob3cgPSBucjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBwYXR0ZXJuU2VhcmNoOiBmdW5jdGlvbihlKXsgXHJcbiAgICAvLyBsZXQgciA9IHtzOmUudGFyZ2V0LnZhbHVlLHQ6dGhpcy5wcm90b3R5cGVzLHRzOnRoaXMucHJvdG90eXBlc1Nob3d9XHJcbiAgICAvLyB0aGlzLl9zZWFyY2goZS50YXJnZXQudmFsdWUsJ3AnKTtcclxuICAgIHRoaXMucHJvdG90eXBlc051bT0wO1xyXG4gICAgdGhpcy5wcm90b3R5cGVTZWFyY2goZS50YXJnZXQudmFsdWUpO1xyXG4gIH0sXHJcbiAgb2JqZWN0U2VhcmNoOiBmdW5jdGlvbihlKXtcclxuICAgIHRoaXMub2JqZWN0c051bT0wO1xyXG4gICAgdGhpcy5vYmplY3RzR2V0QmFzZShlLnRhcmdldC52YWx1ZSk7XHJcbiAgfSxcclxuICBwYXJhbXNTZWFyY2g6IGZ1bmN0aW9uKCl7XHJcbiAgICBcclxuICB9LFxyXG4gIFxyXG4gIHByb3RvdHlwZVNlYXJjaDogZnVuY3Rpb24oKXtcclxuICAgICAgLy8gdGhpcy5fdG9nZ2xlKGUpO1xyXG4gICAgICBsZXQgc1cgPSB0aGlzLiQucGF0dGVyblNlYXJjaEZpZWxkLnZhbHVlO1xyXG4gICAgICAvLyBpZih0aGlzLnByb3RvdHlwZXMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLnByb3RvdHlwZXMubGVuZ3RoID09IDApe1xyXG4gICAgICAgIGxldCBvYmogPSB7XHJcbiAgICAgICAgICBtZXRob2Q6ICdyYy5maW5kJyxcclxuICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICBjbWROYW1lX3ZhbHVlOiAncGF0dGVybnMnLFxyXG4gICAgICAgICAgICBwcm9qZWN0aW9uOiB7YWRkaXRpb25hbDogMH0sXHJcbiAgICAgICAgICAgIHNraXA6IHRoaXMucHJvdG90eXBlc051bSp0aGlzLmxvYWRzQ291bnQsXHJcbiAgICAgICAgICAgIGxpbWl0OnRoaXMubG9hZHNDb3VudCxcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoc1cpe1xyXG4gICAgICAgICAgb2JqLnBhcmFtcy5maWx0ZXI9e1wibWV0YS5uYW1lXCI6eyRyZWdleDogc1csICRvcHRpb25zOidpbSd9fVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhvYmopO1xyXG4gICAgICAgIHRoaXMubG9hZChvYmosJ3JlY2VpdmVkUGF0dGVybnMnKTtcclxuICAgICAgICAvLyB0aGlzLm9iamVjdHNHZXRCYXNlKCk7XHJcbiAgICAgIC8vIH1cclxuICB9LFxyXG4gIG9wZW5PYmplY3RzOiBmdW5jdGlvbihlKXtcclxuICAgICAgbGV0IHIgPSB0aGlzLl90b2dnbGUoZSk7XHJcbiAgICAgIGlmKHImJnRoaXMub2JqZWN0cz09PXVuZGVmaW5lZCl7XHJcbiAgICAgICAgdGhpcy5vYmplY3RzR2V0QmFzZSgpO1xyXG4gICAgICB9XHJcbiAgfSxcclxuICBvYmplY3RzR2V0QmFzZTogZnVuY3Rpb24oKXtcclxuICAgICAgICBsZXQgc1cgPSB0aGlzLiQub2JqZWN0U2VhcmNoRmllbGQudmFsdWU7XHJcbiAgICAgICAgbGV0IHNlbGVjdF9wYXR0ZXJucyA9IHRoaXMuJC5wYXR0ZXJuc1NlYXJjaExpc3QucXVlcnlTZWxlY3RvckFsbCgnLnNlbGVjdGVkJyk7XHJcbiAgICAgICAgbGV0IHNlbGVjdHMgPSBbXTsgXHJcbiAgICAgICAgbGV0IHBhcmFtcyA9IFtdO1xyXG4gICAgICAgIHNlbGVjdF9wYXR0ZXJucy5mb3JFYWNoKGZ1bmN0aW9uKHYpe3NlbGVjdHMucHVzaCh2LmRhdGFIb3N0Lml0ZW0uX2lkKX0pO1xyXG4gICAgICAgIGlmKHRoaXMuJC5leHBhbmRQYXJhbXNTZWFyY2ghPT11bmRlZmluZWQpe1xyXG4gICAgICAgICAgbGV0IHNlbGVjdF9wYXJhbXMgPSB0aGlzLiQuZXhwYW5kUGFyYW1zU2VhcmNoLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gtb2JqZWN0LXBhcmFtcycpO1xyXG4gICAgICAgICAgc2VsZWN0X3BhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uKHYpe1xyXG4gICAgICAgICAgICBpZiAodi52YWx1ZSE9Jycpe1xyXG4gICAgICAgICAgICAgIGxldCBvID0ge31cclxuICAgICAgICAgICAgICBvLmtleT12LmxhYmVsO1xyXG4gICAgICAgICAgICAgIG8udmFsdWU9di52YWx1ZTtcclxuICAgICAgICAgICAgICBwYXJhbXMucHVzaChvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhwYXJhbXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBsZXQgb2JqID0ge1xyXG4gICAgICAgICAgbWV0aG9kOiAncmMuZmluZCcsXHJcbiAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgY21kTmFtZV92YWx1ZTogJ29iamVjdHMnLFxyXG4gICAgICAgICAgICBmaWx0ZXI6IHtcIm1ldGEubm9uX3N5c3RlbVwiOiBmYWxzZX0sXHJcbiAgICAgICAgICAgIC8vIHByb2plY3Rpb246IHtvYmplY3Q6IDB9LFxyXG4gICAgICAgICAgICBwcm9qZWN0aW9uOiB7XCJfaWRcIjoxLFwibWV0YVwiOjF9LFxyXG4gICAgICAgICAgICBza2lwOiB0aGlzLm9iamVjdHNOdW0qdGhpcy5sb2Fkc0NvdW50LFxyXG4gICAgICAgICAgICBsaW1pdDogdGhpcy5sb2Fkc0NvdW50XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIG9iai5wYXJhbXMuZmlsdGVyPXt9XHJcbiAgICAgICAgaWYoc1cpe1xyXG4gICAgICAgICAgb2JqLnBhcmFtcy5maWx0ZXJbXCJtZXRhLm5hbWVcIl09eyRyZWdleDogc1csICRvcHRpb25zOidpbSd9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHNlbGVjdHMubGVuZ3RoPjApe29iai5wYXJhbXMuZmlsdGVyWydtZXRhLnBhdHRlcm4nXT17JGluOnNlbGVjdHN9fVxyXG4gICAgICAgIGlmKHBhcmFtcy5sZW5ndGg+MCl7XHJcbiAgICAgICAgICBmb3IobGV0IGk9cGFyYW1zLmxlbmd0aDtpLS0+MDspe1xyXG4gICAgICAgICAgICBvYmoucGFyYW1zLmZpbHRlclsnb2JqZWN0LicrcGFyYW1zW2ldLmtleV09eyRyZWdleDogcGFyYW1zW2ldLnZhbHVlLCAkb3B0aW9uczonaW0nfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhvYmopO1xyXG4gICAgICAgIHRoaXMubG9hZChvYmosJ3JlY2VpdmVkT2JqZWN0cycpO1xyXG4gIH0sXHJcblxyXG4gICAgc2VsZWN0T2JqZWN0OiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RPYmplY3QnKTtcclxuICAgICAgICBsZXQgaXRlbSA9IGUudGFyZ2V0LmRhdGFIb3N0Lml0ZW07XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ3NlbGVjdE9iamVjdCcsXHJcbiAgICAgICAgICAgIGRhdGE6IGl0ZW1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzZWxlY3RlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdG9iamVjdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpcmUoJ3Vuc2VsZWN0b2JqZWN0JywgcmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy4kLnNlYXJjaERpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdG9iamVjdCcsIHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gIH0sXHJcbiBcclxuIGlzUHJvdG90eXBlU2VsZWN0ZWQ6IGZ1bmN0aW9uKCl7XHJcbiAgLy8gIGNvbnNvbGUubG9nKCdzZWxlY3Q/Jyk7XHJcbiAgIHJldHVybiAhKHRoaXMuJC5wYXR0ZXJuc1NlYXJjaExpc3QucXVlcnlTZWxlY3RvckFsbCgnLnNlbGVjdGVkJykubGVuZ3RoPjApO1xyXG4gfSxcclxuICBcclxuX3RvZ2dsZTogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGxldCBidXR0b25Ub2dnbGUgPSBQb2x5bWVyLmRvbShldmVudCkubG9jYWxUYXJnZXQucGFyZW50Tm9kZTtcclxuICAgICAgLy8gbGV0IGJ1dHRvblRvZ2dsZSA9IGV2ZW50LnBhcmVudE5vZGUudGFyZ2V0O1xyXG4gICAgICBsZXQgZGVzY3JpYmUgPSBQb2x5bWVyLmRvbShidXR0b25Ub2dnbGUpLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignaXJvbi1jb2xsYXBzZScpO1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhkZXNjcmliZSk7XHJcbiAgICAgIGRlc2NyaWJlLnRvZ2dsZSgpO1xyXG4gICAgICByZXR1cm4gZGVzY3JpYmUub3BlbmVkO1xyXG4gICAgICAvLyB0aGlzLmxvYWQoKTtcclxuICAgICAgLy8gYnV0dG9uVG9nZ2xlLmljb24gPSBkZXNjcmliZS5vcGVuZWQgPyAnaWNvbnM6ZXhwYW5kLWxlc3MnIDogJ2ljb25zOmV4cGFuZC1tb3JlJztcclxuICB9LFxyXG5cclxuICBnZXRFdmVudEl0ZW1JZDogZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIC8vIHdpbmRvdy5sb2NhbFN0b3JhZ2UuY2xlYXIoKTsvL0ltcG9ydGFudCB0byBjbGVhciBzdG9yYWdlIGZyb20gb2xkIHBhdHRlcm5cclxuICAgICAgcmV0dXJuIGV2ZW50Lm1vZGVsLml0ZW0uX2lkWyckb2lkJ107XHJcbiAgfSxcclxuICBcclxufSk7Il19
